<!-- æœå‹™ç‹€æ…‹ç›£æ§çµ„ä»¶ -->
<style>
    /* æœå‹™ç‹€æ…‹ç›£æ§ */
    .status-monitor {
        background: white;
        padding: 15px 20px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        font-size: 13px;
    }

    .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    .status-dot.running {
        background: #28a745;
        box-shadow: 0 0 8px #28a745;
    }

    .status-dot.stopped {
        background: #dc3545;
        box-shadow: 0 0 8px #dc3545;
    }

    .status-dot.warning {
        background: #ffc107;
        box-shadow: 0 0 8px #ffc107;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    .status-label {
        font-weight: 500;
        color: #333;
    }

    .status-info {
        color: #666;
        font-size: 11px;
    }
</style>

<div class="status-monitor">
    <div style="font-weight: 500; color: #333; margin-right: 10px;">ğŸš¦ ç³»çµ±ç‹€æ…‹</div>

    <div class="status-item" id="status-bot">
        <div class="status-dot" id="dot-bot"></div>
        <span class="status-label">Bot Server</span>
        <span class="status-info" id="info-bot">æª¢æŸ¥ä¸­...</span>
    </div>

    <div class="status-item" id="status-admin">
        <div class="status-dot running" id="dot-admin"></div>
        <span class="status-label">ç®¡ç†å¾Œå°</span>
        <span class="status-info">é‹è¡Œä¸­</span>
    </div>

    <div class="status-item" id="status-ngrok">
        <div class="status-dot" id="dot-ngrok"></div>
        <span class="status-label">ngrok</span>
        <span class="status-info" id="info-ngrok">æª¢æŸ¥ä¸­...</span>
    </div>

    <div class="status-item" id="status-gmail">
        <div class="status-dot" id="dot-gmail"></div>
        <span class="status-label">Gmail API</span>
        <span class="status-info" id="info-gmail">æª¢æŸ¥ä¸­...</span>
    </div>

    <div class="status-item" id="status-ai">
        <div class="status-dot" id="dot-ai"></div>
        <span class="status-label">Gemini AI</span>
        <span class="status-info" id="info-ai">æª¢æŸ¥ä¸­...</span>
    </div>

    <div style="margin-left: auto; font-size: 11px; color: #999;" id="last-update"></div>
</div>

<script>
    // æœå‹™ç‹€æ…‹ç›£æ§ - è‡ªå‹•æ›´æ–°
    (function () {
        async function updateSystemStatus() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();

                // æ›´æ–° Bot Server
                const dotBot = document.getElementById('dot-bot');
                const infoBot = document.getElementById('info-bot');
                if (data.bot_server.status === 'running') {
                    dotBot.className = 'status-dot running';
                    infoBot.textContent = `é‹è¡Œä¸­ (Port ${data.bot_server.port})`;
                } else if (data.bot_server.status === 'stopped') {
                    dotBot.className = 'status-dot stopped';
                    infoBot.textContent = 'å·²åœæ­¢';
                } else {
                    dotBot.className = 'status-dot warning';
                    infoBot.textContent = 'ç‹€æ…‹æœªçŸ¥';
                }

                // æ›´æ–° ngrok
                const dotNgrok = document.getElementById('dot-ngrok');
                const infoNgrok = document.getElementById('info-ngrok');
                if (data.ngrok.status === 'running') {
                    dotNgrok.className = 'status-dot running';
                    infoNgrok.textContent = `é‹è¡Œä¸­`;
                    infoNgrok.title = data.ngrok.url || '';
                } else if (data.ngrok.status === 'stopped') {
                    dotNgrok.className = 'status-dot stopped';
                    infoNgrok.textContent = 'å·²åœæ­¢';
                } else {
                    dotNgrok.className = 'status-dot warning';
                    infoNgrok.textContent = data.ngrok.status === 'no_tunnels' ? 'ç„¡éš§é“' : 'ç‹€æ…‹æœªçŸ¥';
                }

                // æ›´æ–° Gmail API
                const dotGmail = document.getElementById('dot-gmail');
                const infoGmail = document.getElementById('info-gmail');
                if (data.gmail.status === 'configured') {
                    dotGmail.className = 'status-dot running';
                    infoGmail.textContent = 'å·²é…ç½®';
                } else if (data.gmail.status === 'not_configured') {
                    dotGmail.className = 'status-dot stopped';
                    infoGmail.textContent = 'æœªé…ç½®';
                } else {
                    dotGmail.className = 'status-dot warning';
                    infoGmail.textContent = 'éŒ¯èª¤';
                }

                // æ›´æ–° Gemini AI
                const dotAi = document.getElementById('dot-ai');
                const infoAi = document.getElementById('info-ai');
                if (data.gemini_ai.status === 'configured') {
                    dotAi.className = 'status-dot running';
                    infoAi.textContent = 'å·²é…ç½®';
                } else if (data.gemini_ai.status === 'not_configured') {
                    dotAi.className = 'status-dot stopped';
                    infoAi.textContent = 'æœªé…ç½®';
                } else {
                    dotAi.className = 'status-dot warning';
                    infoAi.textContent = 'éŒ¯èª¤';
                }

                // æ›´æ–°æ™‚é–“
                const now = new Date();
                document.getElementById('last-update').textContent = `æ›´æ–°æ–¼ ${now.toLocaleTimeString('zh-TW')}`;
            } catch (error) {
                console.error('Error updating system status:', error);
            }
        }

        // åˆå§‹åŒ–ä¸¦æ¯ 3 ç§’æ›´æ–°
        updateSystemStatus();
        setInterval(updateSystemStatus, 3000);
    })();
</script>